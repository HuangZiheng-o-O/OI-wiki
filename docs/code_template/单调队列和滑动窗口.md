 

### 单调队列和滑动窗口

单调队列是一种能够在 O(1) 时间复杂度内获取窗口最大值或最小值的数据结构。其基本思想是利用双端队列存储数组下标，并通过以下操作保持队列中元素单调递增或递减。

------

### 代码解析

```cpp
int hh = 0, tt = -1;  // 初始化队列头部(hh)和尾部(tt)
for (int i = 0; i < n; i++) {
    // 1. 移除滑出窗口范围的元素
    while (hh <= tt && check_out(q[hh])) hh++;  // 判断队头是否滑出窗口范围并移除

    // 2. 保持队列单调性（根据需求，递增或递减）
    while (hh <= tt && check(q[tt], i)) tt--;  // 比当前值更不优的元素从队尾弹出

    // 3. 插入当前元素
    q[++tt] = i;  // 将当前元素下标添加到队尾
}
```

------

### 核心逻辑

1. **`check_out(q[hh])`**
    用于判断队列头部的元素是否已滑出当前窗口范围。例如，滑动窗口大小为 `k` 时，可用 `q[hh] <= i - k` 判断是否出界。
2. **`check(q[tt], i)`**
    确定如何保持队列单调性。如果寻找窗口最大值，则队列内下标对应的数组值必须递减，即：
    `arr[q[tt]] <= arr[i]`，弹出队尾元素。
    如果寻找窗口最小值，则队列内下标对应的数组值必须递增，即：
    `arr[q[tt]] >= arr[i]`，弹出队尾元素。
3. **更新队列**
    每次将当前元素的下标 `i` 插入队列尾部，保证队列始终存储可能成为当前窗口最大值或最小值的元素下标。

------

### 使用示例

以下为一个滑动窗口大小为 `k`，寻找每个窗口最大值的具体实现：

```cpp
int q[N];  // 单调队列存储下标
int hh = 0, tt = -1;

for (int i = 0; i < n; i++) {
    // 1. 移除滑出窗口的元素
    if (hh <= tt && q[hh] < i - k + 1) hh++;

    // 2. 移除队列中比当前元素小的元素。由于本来就是单调递减，这个操作后保证下一步q[++tt]是最小的，保持单调递减队列。
    while (hh <= tt && arr[q[tt]] <= arr[i]) tt--;

    // 3. 将当前元素下标入队，是最小的
    q[++tt] = i;

    // 4. 获取当前窗口最大值
    if (i >= k - 1) {
        cout << arr[q[hh]] << " ";  // 队头的下标即为当前窗口最大值。
    }
}
```

------

### 时间复杂度分析

- 每个元素最多入队一次、出队一次，因此总时间复杂度为 **O(n)**。

### 适用场景

1. 滑动窗口最大值/最小值问题。
2. 需要动态维护一个区间的单调性（例如区间最值或某种最优值）。
3. 其他类似窗口动态更新的应用场景。

如果还有疑问或需要其他例子，随时联系！